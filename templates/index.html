<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jornada Épica</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #options button {
      margin-right: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
    #response {
      margin-top: 20px;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>

  <h1>Era uma vez...</h1>

  <div id="texto-estoria"></div>

  <div id="texto-opcoes"></div>

  <div id="options">
    <button onclick="escolha(1)" id="option1">um Dragão!</button>
    <button onclick="escolha(2)" id="option2">um cavaleiro!</button>
  </div>

  <script>
    // variáveis globais
    let capitulo = 0;
    let capitulosDaEstoria;

    window.onload = function() {
        // Use fetch to make the GET request
        fetch("http://localhost:5000/data")
            .then(response => {
                // Check if the response is successful
                if (!response.ok) {
                    throw new Error(`Error: ${response.status} - ${response.statusText}`);
                }
                return response.json(); // Parse the JSON data
            })
            .then(data => {
                // Log the fetched data
                console.log(data);
                capitulosDaEstoria = data;
            })
            .catch(error => {
                // Log any errors that occur
                console.error("Network or parsing error:", error);
            });
    };

    function escolha(option) {
      // pega elemento do texto
      const textoEstoria = document.getElementById('texto-estoria');
      // cria elemento do parágrafo
      const paragraph = document.createElement('p');
      // incrementa número do capítulo
      capitulo++;
      // Cria elemento temporário para facilitar acesso
      //let temp = capitulo.toString();
      temp = option.toString();
      
      // Insere texto na página
      //let node;
      try {
        paragraph.innerHTML = `${capitulosDaEstoria[temp].titulo} ${capitulosDaEstoria[temp].texto}`;
      } catch(err) {
        paragraph.innerHTML = `Erro, falta capítulo da estória!`;
      }
      //paragraph.appendChild(node);
      textoEstoria.appendChild(paragraph);

      // loga para ajudar no debug
      console.log(capitulosDaEstoria[temp].titulo + " " + capitulosDaEstoria[temp].texto);

      updateButtonText("option1",capitulosDaEstoria[temp].opcoes[0]);
      updateButtonText("option2",capitulosDaEstoria[temp].opcoes[1]);
    }

    function updateButtonText(buttonId, text) {
        // Construct the button ID dynamically based on the given ID
        //const buttonId = `option${id}`;
        
        // Get the button element by its ID
        const button = document.getElementById(buttonId);
        
        // If the button exists, update its text content
        if (button) {
            button.textContent = text;
        } else {
            console.error(`Button with id "${buttonId}" not found.`);
        }
    }
  </script>

</body>
</html>
